[git]
conventional = true
filter_unmerged = true
commit_preprocessors = [
  { pattern = "^Merge.+", replace = "" },
]

[changelog]
body = """
## Release {{ version }}
{% if date %}_{{ date }}_{% endif %}

{% if commits | length == 0 %}
No notable changes.
{% else %}
### Highlights
{% for group, commits in commits | group_by(attribute="type") %}
#### {{ group | default(value="other") | upper }}
{% for commit in commits %}
- {{ commit.message | split(pat="\n") | first }} ({{ commit.id | truncate(length=7) }})
{% if commit.body %}  - {{ commit.body | indent(prefix="  ") }}{% endif %}
{% endfor %}
{% endfor %}

### Contributors
{% set contributors = commits | map(attribute="author") | unique %}
{% if contributors | length == 0 %}
- No new contributors for this release.
{% else %}
{% for author in contributors %}
{% set author_name = author.name | default(value=author.email | default(value=author)) %}
{% set author_commits = commits | filter(attribute="author", value=author) %}
- {{ author_name }} ({{ author_commits | length }} commit{% if author_commits | length > 1 %}s{% endif %})
{% endfor %}
{% endif %}
{% endif %}
"""

group_by = ["type"]
trim = true
footer = """
---
Changelog generated by git-cliff.
"""
